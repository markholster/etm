# Changelog
## Version 4.3.0
* [ETM-8](https://github.com/jecstarinnovations/etm/issues/8) Automatic migration.
* [ETM-34](https://github.com/jecstarinnovations/etm/issues/34) Option to sort search templates.
* [ETM-37](https://github.com/jecstarinnovations/etm/issues/37) Autoscroll uses wrong time.
* [ETM-38](https://github.com/jecstarinnovations/etm/issues/38) NullPointerException in Signaler.
* [ETM-39](https://github.com/jecstarinnovations/etm/issues/39) Replace _id with id.
* [ETM-40](https://github.com/jecstarinnovations/etm/issues/40) DirectedGraph causes OutOfMemory.

## Version 4.2.0
* [ETM-32](https://github.com/jecstarinnovations/etm/issues/32) Invalid locale data in all graphs.
* [ETM-33](https://github.com/jecstarinnovations/etm/issues/33) Timezone not taken into account on search page.
* [ETM-35](https://github.com/jecstarinnovations/etm/issues/35) Fine grained access to fields of events.
* [ETM-36](https://github.com/jecstarinnovations/etm/issues/36) Result table width should be 100%.

## Version 4.1.1
* [ETM-23](https://github.com/jecstarinnovations/etm/issues/23) Explain the tokenizer in the documentation.
* [ETM-24](https://github.com/jecstarinnovations/etm/issues/24) Search result table is not showing nested properties.
* [ETM-26](https://github.com/jecstarinnovations/etm/issues/26) Group signals not visible although user has access.
* [ETM-27](https://github.com/jecstarinnovations/etm/issues/27) Multi select does not scroll.
* [ETM-28](https://github.com/jecstarinnovations/etm/issues/28) Option to force migration to run.
* [ETM-29](https://github.com/jecstarinnovations/etm/issues/29) Sort field does not autocomplete.
* [ETM-30](https://github.com/jecstarinnovations/etm/issues/30) User with 'Read without payload' access can see log payload.
* [ETM-31](https://github.com/jecstarinnovations/etm/issues/31) Index statistics misformed.

## Version 4.1.0
* [ETM-133](https://jecstar.atlassian.net/browse/ETM-133) Scripts of old version are cached in browser.
* [ETM-134](https://jecstar.atlassian.net/browse/ETM-134) Option to set font size on number graphs.
* [ETM-135](https://jecstar.atlassian.net/browse/ETM-135) etm-commons.js not working in IE11.
* [ETM-136](https://jecstar.atlassian.net/browse/ETM-136) Text is overlapping in endpoints view.
* [ETM-137](https://jecstar.atlassian.net/browse/ETM-137) Support Elasticsearch Remote Clusters.
* [ETM-138](https://jecstar.atlassian.net/browse/ETM-138) Opensource Enterprise Telemetry Monitor.
* [ETM-1](https://github.com/jecstarinnovations/etm/issues/1) Unable to set threshold fractions.
* [ETM-2](https://github.com/jecstarinnovations/etm/issues/2) Response table in search screen doesn't wrap long names.
* [ETM-3](https://github.com/jecstarinnovations/etm/issues/3) Elasticsearch exception in MetricReporter.
* [ETM-5](https://github.com/jecstarinnovations/etm/issues/5) Number graphs should have a bottom margin.
* [ETM-6](https://github.com/jecstarinnovations/etm/issues/6) Graph borders should be removed.
* [ETM-11](https://github.com/jecstarinnovations/etm/issues/11) Enhance search screen with custom fields.
* [ETM-13](https://github.com/jecstarinnovations/etm/issues/13) Unable to sort results on handling_time.
* [ETM-14](https://github.com/jecstarinnovations/etm/issues/14) Search endpoint returns duplicate keys.
* [ETM-15](https://github.com/jecstarinnovations/etm/issues/15) NumberFormatException in Endpoints and Chain time tabs.
* [ETM-16](https://github.com/jecstarinnovations/etm/issues/16) IIB Node should support SSL.
* [ETM-17](https://github.com/jecstarinnovations/etm/issues/17) IIB Node password not set.
* [ETM-18](https://github.com/jecstarinnovations/etm/issues/18) Unexplainable error: Found a cycle in the event order.
* [ETM-19](https://github.com/jecstarinnovations/etm/issues/19) All query input fields should be textareas.
* [ETM-20](https://github.com/jecstarinnovations/etm/issues/20) Script error when using escaped query.
* [ETM-21](https://github.com/jecstarinnovations/etm/issues/21) Option to move to next/previous event in event details screen.
* [ETM-22](https://github.com/jecstarinnovations/etm/issues/22) Connection leak in IBM MQ Processor.

## Version 4.0.1
* [ETM-132](https://jecstar.atlassian.net/browse/ETM-132) Use UnboundID provider for LDAP connection.

## Version 4.0.0

* [ETM-18](https://jecstar.atlassian.net/browse/ETM-18) Allow/Deny server certificates.
* [ETM-23](https://jecstar.atlassian.net/browse/ETM-23) Remove all api references to event type.
* [ETM-103](https://jecstar.atlassian.net/browse/ETM-103) Change gui to themekita.
* [ETM-105](https://jecstar.atlassian.net/browse/ETM-105) Option to export and import graphs + signals.
* [ETM-106](https://jecstar.atlassian.net/browse/ETM-106) Upgrade to elasticsearch 7.x
* [ETM-107](https://jecstar.atlassian.net/browse/ETM-107) Add a quicksearch bar.
* [ETM-108](https://jecstar.atlassian.net/browse/ETM-108) Replace endpoint configuration with import profiles.
* [ETM-109](https://jecstar.atlassian.net/browse/ETM-109) Endpoints tab should show all endpoints in chain.
* [ETM-110](https://jecstar.atlassian.net/browse/ETM-110) Ldap groups never reloaded.
* [ETM-113](https://jecstar.atlassian.net/browse/ETM-113) Email recipients disappeared after saving signal.
* [ETM-114](https://jecstar.atlassian.net/browse/ETM-114) java.lang.IllegalArgumentException during migration of version 3.5.2.
* [ETM-115](https://jecstar.atlassian.net/browse/ETM-115) Show application instance in event chain tab.
* [ETM-116](https://jecstar.atlassian.net/browse/ETM-116) Show stacktrace in console and tail commands.
* [ETM-117](https://jecstar.atlassian.net/browse/ETM-117) Legend not correct in Pie charts.
* [ETM-120](https://jecstar.atlassian.net/browse/ETM-120) Rewrite license system to request units.
* [ETM-121](https://jecstar.atlassian.net/browse/ETM-121) Create metric for ringbuffer length of data.
* [ETM-122](https://jecstar.atlassian.net/browse/ETM-122) Add Javascript parser.
* [ETM-123](https://jecstar.atlassian.net/browse/ETM-123) Api key rotation.
* [ETM-124](https://jecstar.atlassian.net/browse/ETM-124) Better documentation of search options in gui.
* [ETM-125](https://jecstar.atlassian.net/browse/ETM-125) Apikey reused when creating a new user.
* [ETM-126](https://jecstar.atlassian.net/browse/ETM-126) Allow WITH REQUEST|RESPONSE joins in Signals and Graphs.
* [ETM-127](https://jecstar.atlassian.net/browse/ETM-127) Export/import queries.
* [ETM-128](https://jecstar.atlassian.net/browse/ETM-128) A signal that throws an exception kills al subsequent signals.
* [ETM-129](https://jecstar.atlassian.net/browse/ETM-129) Error saving graph in ETM Acceptance environment.
* [ETM-130](https://jecstar.atlassian.net/browse/ETM-130) Log username with errors.
* [ETM-131](https://jecstar.atlassian.net/browse/ETM-131) Provide distribution with JRE included.

## Version 3.5.2

* [ETM-112](https://jecstar.atlassian.net/browse/ETM-112) Note that auto scaling to maxNrOfListeners only works on local queues.
* [ETM-111](https://jecstar.atlassian.net/browse/ETM-111) ETM stops reading messages after 5 minutes.

## Version 3.5.1
* [ETM-100](https://jecstar.atlassian.net/browse/ETM-100) Log to console when quiet = false.
* [ETM-101](https://jecstar.atlassian.net/browse/ETM-101) Calendar buttons in signals & graphs not working in IE.
* [ETM-102](https://jecstar.atlassian.net/browse/ETM-102) Memory leak in LruCache.

## Version 3.5.0
* [ETM-95](https://jecstar.atlassian.net/browse/ETM-95) Add api key to user for for authorisation on rest processor.
* [ETM-96](https://jecstar.atlassian.net/browse/ETM-96) Wrong timestamp when using flatpickr.
* [ETM-97](https://jecstar.atlassian.net/browse/ETM-97) License reload may fail when system under stress.
* [ETM-98](https://jecstar.atlassian.net/browse/ETM-98) Option to configure the context root of the gui and rest processor.
* [ETM-99](https://jecstar.atlassian.net/browse/ETM-99) Order By and Path not correctly displayed when showing graph data.

## Version 3.4.1
* [ETM-86](https://jecstar.atlassian.net/browse/ETM-86) Dashboard and signal datasources not refreshed in groups settings screen.
* [ETM-87](https://jecstar.atlassian.net/browse/ETM-87) Dashboard context menu hidden when insufficient height in column.
* [ETM-88](https://jecstar.atlassian.net/browse/ETM-88) Option to disable a Signal.
* [ETM-89](https://jecstar.atlassian.net/browse/ETM-89) Autocomplete not working in graphs and signals.
* [ETM-90](https://jecstar.atlassian.net/browse/ETM-90) Graphs not working in IE.
* [ETM-91](https://jecstar.atlassian.net/browse/ETM-91) Click on search result might show an empty page.
* [ETM-92](https://jecstar.atlassian.net/browse/ETM-92) Wrong name in pipeline path selector when referencing other pipelines.
* [ETM-93](https://jecstar.atlassian.net/browse/ETM-93) Missing thousands separator in Number graphs.
* [ETM-94](https://jecstar.atlassian.net/browse/ETM-94) Number graphs not refreshing on dashboard.

## Version 3.4.0
* [ETM-17](https://jecstar.atlassian.net/browse/ETM-17) Migrate etm-domain to public repository.
* [ETM-51](https://jecstar.atlassian.net/browse/ETM-51) Migrate to Elasticsearch REST client.
* [ETM-76](https://jecstar.atlassian.net/browse/ETM-76) Advanced graphs.
* [ETM-77](https://jecstar.atlassian.net/browse/ETM-77) Fix "Accessing variable [ctx] via [params.ctx] from within a update script is deprecated in favor of directly accessing [ctx]".
* [ETM-78](https://jecstar.atlassian.net/browse/ETM-78) Unable to show event chain when response time is sub millisecond.
* [ETM-79](https://jecstar.atlassian.net/browse/ETM-79) Payload correlated event is visible with role "Read without payload".
* [ETM-80](https://jecstar.atlassian.net/browse/ETM-80) Upgrade to Elasticsearch 6.6.
* [ETM-84](https://jecstar.atlassian.net/browse/ETM-84) Remove WADL exposure.
* [ETM-85](https://jecstar.atlassian.net/browse/ETM-85) Migrate docker image to AdoptOpenJdk 11.

## Version 3.3.0
* [ETM-57](https://jecstar.atlassian.net/browse/ETM-57) Sorting not working on all fields.
* [ETM-58](https://jecstar.atlassian.net/browse/ETM-58) Query on dashboards should default to all attributes.
* [ETM-60](https://jecstar.atlassian.net/browse/ETM-60) Expose and authorize all datasources in dashboard/signal.
* [ETM-61](https://jecstar.atlassian.net/browse/ETM-61) Add health check page.
* [ETM-62](https://jecstar.atlassian.net/browse/ETM-62) Move jvm options to separate file.
* [ETM-63](https://jecstar.atlassian.net/browse/ETM-63) Use user timezone in event chain details.
* [ETM-64](https://jecstar.atlassian.net/browse/ETM-64) Use button to open calendar in search screen.
* [ETM-65](https://jecstar.atlassian.net/browse/ETM-65) Add startdate and enddate fields on graphs.
* [ETM-66](https://jecstar.atlassian.net/browse/ETM-66) Make endpoint cache size configurable.
* [ETM-67](https://jecstar.atlassian.net/browse/ETM-67) Option to set timestamp fields in search result table as start or end date for the query.
* [ETM-68](https://jecstar.atlassian.net/browse/ETM-68) Sorting on metric in term aggregator not working when sub aggregator is present.
* [ETM-69](https://jecstar.atlassian.net/browse/ETM-69) Migrate to Elasticsearch 6.4.
* [ETM-70](https://jecstar.atlassian.net/browse/ETM-70) Allow search time filter on all time fields.
* [ETM-71](https://jecstar.atlassian.net/browse/ETM-71) Add role that allows to see all but payload from event.
* [ETM-72](https://jecstar.atlassian.net/browse/ETM-72) Log downloads in audit log.
* [ETM-73](https://jecstar.atlassian.net/browse/ETM-73) Add SNMP notifier.
* [ETM-75](https://jecstar.atlassian.net/browse/ETM-75) Drop nvd3 and migrate all charts to Highcharts.

## Version 3.2.0
* [ETM-14](https://jecstar.atlassian.net/browse/ETM-14) Add signals.
* [ETM-43](https://jecstar.atlassian.net/browse/ETM-43) Start script always starts 'tail' functionality.
* [ETM-44](https://jecstar.atlassian.net/browse/ETM-44) Set empty id's to 'null' in processors.
* [ETM-45](https://jecstar.atlassian.net/browse/ETM-45) Add http status code field.
* [ETM-46](https://jecstar.atlassian.net/browse/ETM-46) Group visualizations not visible in some cases.
* [ETM-47](https://jecstar.atlassian.net/browse/ETM-47) LDAP groups of user not visible in users screen.
* [ETM-49](https://jecstar.atlassian.net/browse/ETM-49) Option to use secure cookies.
* [ETM-50](https://jecstar.atlassian.net/browse/ETM-50) Label required fields italic.
* [ETM-52](https://jecstar.atlassian.net/browse/ETM-52) Index of current day unwritable after migration from 2.4 to 3.1.1.
* [ETM-53](https://jecstar.atlassian.net/browse/ETM-53) Parser keeps attached to endpoint when removed.
* [ETM-54](https://jecstar.atlassian.net/browse/ETM-54) Payload not visible when invalid payload_format is set.
* [ETM-55](https://jecstar.atlassian.net/browse/ETM-55) XsltExpressionParser is not thread safe.

## Version 3.1.1
* [ETM-33](https://jecstar.atlassian.net/browse/ETM-33) Fix upgrade documentation on website.
* [ETM-34](https://jecstar.atlassian.net/browse/ETM-34) Autocomplete not working in IE.
* [ETM-35](https://jecstar.atlassian.net/browse/ETM-35) Download transaction to file.
* [ETM-36](https://jecstar.atlassian.net/browse/ETM-36) Option to show ETM logs from command line.
* [ETM-37](https://jecstar.atlassian.net/browse/ETM-37) No results when sorting on non-existing field.
* [ETM-38](https://jecstar.atlassian.net/browse/ETM-38) Apply the same filterquery only one time.
* [ETM-39](https://jecstar.atlassian.net/browse/ETM-39) env connectAddresses not working in Docker.
* [ETM-40](https://jecstar.atlassian.net/browse/ETM-40) Default search templates not working anymore.
* [ETM-41](https://jecstar.atlassian.net/browse/ETM-41) Graphs not updating in IE.
* [ETM-42](https://jecstar.atlassian.net/browse/ETM-42) Add first reader time to event details screen.

## Version 3.1.0
* LDAP Synchronization of users.
* Fixed bug in removing account with user settings access.
* Added features requested by [Achmea](https://www.achmea.nl).
* Allow the [XSLT parser](../administrating/parsers.md#xslt-parser) as transforming parser on an Endpoint.
* Add metadata to endpoint handler.
* Moved reading_endpoint_handlers and writing_endpoint_handler to endpoint_handlers.

## Version 3.0.2
* Fixed a bug that failed migrations from 2.x to 3.0.x because of metric fields containing NaN.
* Changed spinner in top right corner to a pulsing Jecstar logo in the top left corner.

## Version 3.0.1
* Added a Regular expression parser
* Option to change payload before it is store in Elasticsearch

## Version 3.0.0
* Added the [Kafka](https://kafka.apache.org/) processor.
* Sophisticated access control for every single page.
* Migration to Elasticsearch 6.2.x.
* Support for Java 9.
* Parsers can use metadata as source for parsing.
* Added a *Copy value* parser.
* Make the number of update threads to Elasticsearch configurable.
* Support for bulk events in JMS & MQ processor.

# Upgrades
Enterprise Telemetry Monitor is maintaining a semantic versioning strategy. Given a version number MAJOR.MINOR.PATCH, increment the:

* MAJOR version when Enterprise Telemetry Monitor contains incompatible API changes,
* MINOR version when Enterprise Telemetry Monitor adds functionality in a backwards-compatible manner, and
* PATCH version when Enterprise Telemetry Monitor makes backwards-compatible bug fixes.

Additional labels for pre-release and build metadata are available as extensions to the MAJOR.MINOR.PATCH format.

## Upgrades within the same MAJOR version.

1. Make sure you have a backup of all Elasticsearch data!
1. Download and uncompress the required Elasticsearch version to a new directory. See the [Support matrix](../support-matrix/README.md) for the version you should run.
1. Stop all Enterprise Telemetry Monitor nodes.
1. Stop your current Elasticsearch nodes.
1. Merge changes from the`config/elasticsearch.yml`,  `config/jvm.options` and `config/log4j2.properties` files in your current Elasticsearch nodes to your new ones. Note that merging is only recommended when you have made changes to those files. When you've not changed anything in those files it is recommended to leave them untouched in your new Elasticsearch installation.
1. If your Elasticsearch data resides in the same directory as your Elasticsearch installation make sure you copy the data to the new Elasticsearch installation.
1. Start your new Elasticsearch nodes and wait for the message ```Cluster health status changed from [RED] to [GREEN]``` to appear.
1. Download and uncompress Enterprise Telemetry Monitor to a new directory.
1. Copy all files under `lib/ext/` from your old Enterprise Telemetry Monitor installation to the new one.
1. Copy the `config/etm.yml` & `config/jvm.options` files from your old Enterprise Telemetry Monitor installation to the new one. Note that older versions of Enterprise Telemetry Monitor might not have a 'config/jvm.options' file.
1. Check if any of the [Version specific changes](#version-specific-changes) applies to your situation.
1. Start your Enterprise Telemetry Monitor nodes.

## Upgrade from version 3.5.x to 4.x
1. Your data will be converted during the upgrade so as always make sure you have a backup of all Elasticsearch data!
1. Make sure you have a non-ldap (local) admin account! Enterprise Telemetry Monitor requires the import of server certificates starting with release 4.x so you wont be able to login using an LDAP account configured on an LDAP server connected over TLS.
1. Make sure you have received a new license. Older licenses are not compatible with the license required by Enterprise Telemetry Monitor 4 and higher.
1. Enterprise Telemetry Monitor requires Java 11. Download and install Java 11 when necessary.
1. Download and uncompress Elasticsearch 7.x to a new directory.
1. Stop all Enterprise Telemetry Monitor nodes.
1. Stop your current Elasticsearch nodes.
1. Merge changes from the `config/elasticsearch.yml`, `config/jvm.options` and `config/log4j2.properties` files in your current Elasticsearch nodes to your new ones. Note that merging is only recommended when you have made changes to those files. When you've not changed anything in those files it is recommended to leave them untouched in your new Elasticsearch installation.
1. If your Elasticsearch data resides in the same directory as your Elasticsearch installation make sure you copy the data to the new Elasticsearch installation.
1. Start your new Elasticsearch nodes and wait for the message ```Cluster health status changed from [RED] to [GREEN]``` to appear.
1. Download and uncompress Enterprise Telemetry Monitor 4.x to a new directory.
1. Copy all files under `lib/ext/` from your old Enterprise Telemetry Monitor installation to the new one.
1. Copy the `config/etm.yml` & `config/jvm.options` files from your old Enterprise Telemetry Monitor installation to the new one.
1. Disable all processors in the etm.yml. This will prevent events to be processed when your new license isn't entered yet.
1. Start a single Enterprise Telemetry Monitor node in console mode and wait for the data migration to complete. Login to Enterprise Telemetry Monitor and validate the migration.
1. [Import](../administrating/license-registration.md) your new license.
1. [Import](../administrating/cluster.md#certificate-settings) your LDAP and/or SMTP certificates used to setup a secure connection.
1. Validate everything is working fine. Stop the running Enterprise Telemetry Monitor node.  
1. Enable all required processors when disabled in a previous step and restart the node.
1. Start all Enterprise Telemetry Monitor nodes.

## Version specific changes
Sometimes your Enterprise Telemetry Monitor configuration needs additional changes before it can be upgraded. This section describes these changes necessary before upgrading.

### Upgrade from versions before 3.5.0 to 3.5.x or higher
1. Remove the option `restProcessorLoginRequired` in the http chapter in the file `config/etm.yml`. This option is replaced by the api key functionality.

### Upgrade from versions before 3.4.0 to 3.4.x or higher
1. Change the `connectAddresses` in the elasticsearch chapter from the Elasticsearch transport address to the Elasticsearch http address.
1. Remove the options `sslEnabled`, `sslKeyLocation`, `sslCertificateLocation` & `sslCertificateAuthoritiesLocation` in the elasticsearch chapter in the file `config/etm.yml`. These options are replaced by `sslTrustStoreLocation` and `sslTrustStorePassword` which can hold a jks key store.
